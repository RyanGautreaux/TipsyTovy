<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>TipSplit</title>
<meta name="theme-color" content="#00a86b">
<link rel="manifest" href="manifest.json">
<style>
  :root {
    --green: #00a86b;
    --bg: #f6f7f9;
    --white: #fff;
    --text: #111;
    --muted: #666;
    --border: #e4e6ea;
  }
  body { margin:0; font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); }
  .container { max-width: 1000px; margin: 0 auto; padding: 16px; }
  h1 { font-size: 1.9rem; color: var(--green); text-align: center; margin: 6px 0 12px; }
  .card { background: var(--white); border: 1px solid var(--border); border-radius: 16px; padding: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
  label { font-size: 0.85rem; color: var(--muted); display:block; }
  input[type="number"], input[type="text"] { width: 100%; padding: 10px; margin-top: 4px; margin-bottom: 10px; border: 1px solid var(--border); border-radius: 12px; font-size: 1rem; }
  input[type="checkbox"] { transform: scale(1.2); margin-right: 8px; }
  .row { display:flex; gap:8px; align-items:center; }
  .btn { background: var(--green); color: #fff; border: none; padding: 10px 14px; border-radius: 12px; font-weight: 600; cursor: pointer; }
  .btn.ghost { background:#d0d5db; color:#111; }
  .btn:hover { opacity: .92; }
  .grid { display:grid; gap:12px; }
  @media (min-width: 760px) { .grid.cols-2 { grid-template-columns: repeat(2,1fr); } .grid.cols-3 { grid-template-columns: repeat(3,1fr); } .grid.cols-4 { grid-template-columns: repeat(4,1fr); } }
  .metric { background: var(--white); border: 1px solid var(--border); border-radius: 12px; padding: 12px; text-align:center; }
  .metric .label { font-size: .8rem; color: var(--muted); }
  .metric .value { font-weight: 800; font-size: 1.1rem; color: var(--green); }
  .pill { border: 1px solid var(--border); border-radius: 16px; background:#fff; padding: 10px 12px; display:flex; justify-content:space-between; align-items:center; }
  .small { font-size:.8rem; color:var(--muted); }
  .hint { font-size:.8rem; color:var(--muted); margin-top:-6px; }
  .section-title { font-weight:700; margin: 0 0 6px; }
</style>
</head>
<body>
<div class="container">
  <h1>TipSplit ðŸ’š</h1>

  <!-- Totals -->
  <div class="card">
    <div class="grid cols-3">
      <div>
        <label>Credit Card Tips ($)</label>
        <input id="cc" type="number" step="0.01" min="0" placeholder="0.00">
      </div>
      <div>
        <label>Cash Tips ($)</label>
        <input id="cash" type="number" step="0.01" min="0" placeholder="0.00">
      </div>
      <div class="row" style="align-items:end;">
        <button class="btn" onclick="copyBreakdown()">Copy</button>
        <button class="btn ghost" onclick="resetAll()">Reset</button>
      </div>
    </div>
  </div>

  <div class="grid cols-2" style="margin-top:12px;">
    <!-- Roles / Percents -->
    <div class="card">
      <div class="section-title">Roles & Percentages</div>

      <label>Busser pool % of total</label>
      <input id="busPoolPct" type="number" step="0.1" value="15">

      <label># of Bussers (1â€“3)</label>
      <input id="busCount" type="number" min="1" max="3" value="2">

      <div class="grid cols-3" id="busserPercents"></div>
      <div class="hint" id="busserHint">Bussersâ€™ shares must sum to 100% â€” will normalize if not.</div>

      <div class="row" style="margin-top:8px;">
        <input id="bartenderOn" type="checkbox" checked>
        <label for="bartenderOn" style="margin:0;">Bartender</label>
      </div>
      <div id="bartenderRow">
        <label>Bartender % of total</label>
        <input id="bartenderPct" type="number" step="0.1" value="5">
      </div>

      <div class="row" style="margin-top:8px;">
        <input id="runnerOn" type="checkbox" checked>
        <label for="runnerOn" style="margin:0;">Runners</label>
      </div>
      <div id="runnerRow">
        <label>Runner pool % of total</label>
        <input id="runnerPct" type="number" step="0.1" value="7.5">

        <label># of Runners (1â€“2)</label>
        <input id="runnerCount" type="number" min="1" max="2" value="1">

        <div class="grid cols-2" id="runnerPercents"></div>
        <div class="hint" id="runnerHint">Runner shares must sum to 100% â€” will normalize if not.</div>
      </div>
    </div>

    <!-- Names -->
    <div class="card">
      <div class="section-title">Names</div>
      <label>Busser 1</label><input id="bus1Name" type="text" value="Busser 1">
      <label>Busser 2</label><input id="bus2Name" type="text" value="Busser 2">
      <label>Busser 3</label><input id="bus3Name" type="text" value="Busser 3">
      <label>Runner 1</label><input id="runner1Name" type="text" value="Runner 1">
      <label>Runner 2</label><input id="runner2Name" type="text" value="Runner 2">
      <label>Waiters (comma separated)</label><input id="waiters" type="text" value="Waiter 1, Waiter 2">
    </div>
  </div>

  <!-- Results -->
  <div class="card" style="margin-top:12px;">
    <div class="section-title">Results</div>
    <div class="grid cols-4">
      <div class="metric"><div class="label">Total</div><div class="value" id="mTotal">$0.00</div></div>
      <div class="metric"><div class="label" id="mBusPoolLabel">Bussers pool</div><div class="value" id="mBusPool">$0.00</div></div>
      <div class="metric"><div class="label" id="mRunnerLabel">Runners</div><div class="value" id="mRunner">$0.00</div></div>
      <div class="metric"><div class="label">Waiters pool</div><div class="value" id="mRemain">$0.00</div></div>
    </div>
    <div class="grid cols-3" style="margin-top:12px;" id="busserMetrics"></div>
    <div id="payoutList" style="margin-top:10px;"></div>
    <div class="small" id="checkLine" style="margin-top:8px;"></div>
  </div>
</div>

<script>
function $(id){return document.getElementById(id);}
function toCents(v){const n=parseFloat(v);return isNaN(n)?0:Math.round(n*100);}
function fmtUSD(c){return new Intl.NumberFormat('en-US',{style:'currency',currency:'USD'}).format((c||0)/100);}
function round50(c){const d=c/100;const r=Math.round(d*2)/2;return Math.round(r*100);}
function splitByWeights(total, weights){
  const sum = weights.reduce((a,b)=>a+b,0);
  if (sum<=0) return weights.map(_=>0);
  const raw = weights.map(w => (total * w) / sum);
  const floors = raw.map(x => Math.floor(x));
  let rem = total - floors.reduce((a,b)=>a+b,0);
  const idxs = raw.map((x,i)=>({i, frac: x - Math.floor(x)})).sort((a,b)=>b.frac-a.frac);
  for (let k=0;k<idxs.length && rem>0;k++){ floors[idxs[k].i]++; rem--; }
  return floors;
}

function renderBusserPercentInputs(){
  const n = Math.max(1, Math.min(3, parseInt($('busCount').value||'1',10)));
  const host = $('busserPercents');
  host.innerHTML = '';
  for (let i=1;i<=n;i++){
    const wrap=document.createElement('div');
    const lab=document.createElement('label'); lab.textContent=`Busser ${i} % of busser pool`;
    const inp=document.createElement('input'); inp.type='number'; inp.step='0.1';
    inp.value=(i===1&&n===2)?65:(n===2&&i===2?35:(n===3?(i<3?33:34):100));
    inp.id=`bus${i}Pct`;
    wrap.appendChild(lab); wrap.appendChild(inp);
    host.appendChild(wrap);
    inp.addEventListener('input', recalc);
  }
}

function renderRunnerPercentInputs(){
  const n = Math.max(1, Math.min(2, parseInt($('runnerCount').value||'1',10)));
  const host = $('runnerPercents');
  host.innerHTML = '';
  for (let i=1;i<=n;i++){
    const wrap=document.createElement('div');
    const lab=document.createElement('label'); lab.textContent=`Runner ${i} % of runner pool`;
    const inp=document.createElement('input'); inp.type='number'; inp.step='0.1';
    inp.value=(n===1?100:(i===1?50:50));
    inp.id=`runner${i}Pct`;
    wrap.appendChild(lab); wrap.appendChild(inp);
    host.appendChild(wrap);
    inp.addEventListener('input', recalc);
  }
}

function recalc(){
  const cc = toCents($('cc').value);
  let cash = toCents($('cash').value);
  const total = cc + cash;

  const busPoolPct = parseFloat($('busPoolPct').value)||0;
  const bartenderOn = $('bartenderOn').checked;
  const bartenderPct = parseFloat($('bartenderPct').value)||0;
  const runnerOn = $('runnerOn').checked;
  const runnerPct = parseFloat($('runnerPct').value)||0;

  const busCount = Math.max(1, Math.min(3, parseInt(($('busCount').value||'1'),10)));
  const busserWeights=[];
  for(let i=1;i<=busCount;i++){
    const v=parseFloat(($(`bus${i}Pct`)?.value)||0);
    busserWeights.push(Math.max(0,v));
  }

  const bartender = bartenderOn ? Math.round(total * (bartenderPct/100)) : 0;
  const busPool = Math.round(total * (busPoolPct/100));
  const busserTargets = splitByWeights(busPool,busserWeights);

  const busserCash = Array(busCount).fill(0);
  for(let i=0;i<busCount;i++){
    const need=busserTargets[i]-busserCash[i];
    const pay=Math.min(cash,Math.max(0,need));
    busserCash[i]+=pay; cash-=pay;
  }

  const busserBook = busserTargets.map((t,i)=>Math.max(0,t-busserCash[i]));
  const busserTotals = busserTargets.map((_,i)=>round50(busserBook[i]+busserCash[i]));
  const bussersSum = busserTotals.reduce((a,b)=>a+b,0);

  // Runners
  const runnerCount = Math.max(1, Math.min(2, parseInt(($('runnerCount').value||'1'),10)));
  const runnerWeights=[];
  for(let i=1;i<=runnerCount;i++){
    const v=parseFloat(($(`runner${i}Pct`)?.value)||0);
    runnerWeights.push(Math.max(0,v));
  }
  const runnerPool = runnerOn ? Math.round(total * (runnerPct/100)) : 0;
  const runnerTargets = splitByWeights(runnerPool,runnerWeights);

  const runnerCash=Array(runnerCount).fill(0);
  for(let i=0;i<runnerCount && cash>0;i++){
    const need=runnerTargets[i]-runnerCash[i];
    const pay=Math.min(cash,Math.max(0,need));
    runnerCash[i]+=pay; cash-=pay;
  }
  const runnerBook=runnerTargets.map((t,i)=>Math.max(0,t-runnerCash[i]));
  const runnerTotals=runnerTargets.map((_,i)=>round50(runnerBook[i]+runnerCash[i]));
  const runnersSum=runnerTotals.reduce((a,b)=>a+b,0);

  const remaining=total-(bussersSum+runnersSum+bartender);

  const waiterNames=$('waiters').value.split(',').map(x=>x.trim()).filter(Boolean);
  const waiterSplit=(function(){
    if(waiterNames.length===0)return{list:[],each:0};
    const base=Math.floor(remaining/waiterNames.length);
    let rem=remaining-base*waiterNames.length;
    const list=Array.from({length:waiterNames.length},(_,i)=>base+(i<rem?1:0));
    return{list,each:base};
  })();

  $('mTotal').textContent=fmtUSD(total);
  $('mBusPoolLabel').textContent=`Bussers pool (${busPoolPct}%)`;
  $('mBusPool').textContent=fmtUSD(busPool);
  $('mRunnerLabel').textContent=runnerOn?`Runners (${runnerPct}%)`:'Runners (off)';
  $('mRunner').textContent=fmtUSD(runnerPool);
  $('mRemain').textContent=fmtUSD(remaining);

  const busMetrics=$('busserMetrics'); busMetrics.innerHTML='';
  for(let i=0;i<busCount;i++){
    const box=document.createElement('div');
    box.className='metric';
    const name=($(`bus${i+1}Name`)?.value)||`Busser ${i+1}`;
    box.innerHTML=`<div class="label">${name}</div><div class="value">${fmtUSD(busserTotals[i])}</div>`;
    busMetrics.appendChild(box);
  }

  const list=$('payoutList'); list.innerHTML='';

  if(bartenderOn){
    const bartDiv=document.createElement('div');
    bartDiv.className='pill';
    bartDiv.innerHTML=`<div><b>Bartender</b><div class="small">${bartenderPct}% of total</div></div><div><b>${fmtUSD(bartender)}</b></div>`;
    list.appendChild(bartDiv);
  }

  for(let i=0;i<busCount;i++){
    const name=($(`bus${i+1}Name`)?.value)||`Busser ${i+1}`;
    const row=document.createElement('div');
    row.className='pill';
    row.innerHTML=`<div><b>${name}</b><div class="small">Cash: ${fmtUSD(busserCash[i])} + Book: ${fmtUSD(busserBook[i])}</div></div><div><b>${fmtUSD(busserTotals[i])}</b></div>`;
    list.appendChild(row);
  }

  for(let i=0;i<runnerCount;i++){
    const name=($(`runner${i+1}Name`)?.value)||`Runner ${i+1}`;
    const row=document.createElement('div');
    row.className='pill';
    row.innerHTML=`<div><b>${name}</b><div class="small">Cash: ${fmtUSD(runnerCash[i])} + Book: ${fmtUSD(runnerBook[i])}</div></div><div><b>${fmtUSD(runnerTotals[i])}</b></div>`;
    list.appendChild(row);
  }

  waiterNames.forEach((n,i)=>{
    const cents=waiterSplit.list[i]||0;
    const d=document.createElement('div');
    d.className='pill';
    d.innerHTML=`<div><b>${n}</b><div class="small">Equal share</div></div><div><b>${fmtUSD(cents)}</b></div>`;
    list.appendChild(d);
  });

  const sum=bussersSum+bartender+runnersSum+waiterSplit.list.reduce((a,b)=>a+b,0);
  $('checkLine').textContent=`Check: ${fmtUSD(sum)} = ${fmtUSD(total)}`;
}

['cc','cash','busPoolPct','busCount','bartenderOn','bartenderPct','runnerOn','runnerPct','bus1Name','bus2Name','bus3Name','runner1Name','runner2Name','waiters']
.for
