<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>TipSplit</title>
<meta name="theme-color" content="#00a86b">
<link rel="manifest" href="manifest.json">
<style>
  :root {
    --green: #00a86b;
    --bg: #f9fafb;
    --white: #fff;
    --text: #111;
    --muted: #666;
    --border: #ddd;
  }
  body {
    margin:0;
    font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
    background: var(--bg);
    color: var(--text);
  }
  .container {
    max-width: 900px;
    margin: 0 auto;
    padding: 16px;
  }
  h1 {
    font-size: 1.8rem;
    color: var(--green);
    text-align: center;
  }
  .card {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 16px;
    margin-top: 12px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }
  label {
    font-size: 0.85rem;
    color: var(--muted);
  }
  input {
    width: 100%;
    padding: 10px;
    margin-top: 4px;
    margin-bottom: 12px;
    border: 1px solid var(--border);
    border-radius: 12px;
    font-size: 1rem;
  }
  button {
    background: var(--green);
    color: #fff;
    border: none;
    padding: 10px 14px;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
  }
  button:hover { opacity: 0.9; }
  .grid { display: grid; gap: 12px; }
  @media(min-width:720px) {
    .grid.cols-2 { grid-template-columns: repeat(2,1fr); }
    .grid.cols-3 { grid-template-columns: repeat(3,1fr); }
  }
  .metric {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 12px;
    text-align:center;
  }
  .metric .label { font-size: 0.8rem; color: var(--muted); }
  .metric .value { font-weight: 700; font-size: 1.1rem; color: var(--green); }
  .pill {
    border: 1px solid var(--border);
    border-radius: 16px;
    background: #fff;
    padding: 10px 12px;
    display:flex;
    justify-content: space-between;
    align-items:center;
  }
  .small { font-size:0.8rem; color:var(--muted); }
</style>
</head>
<body>
<div class="container">
  <h1>TipSplit ðŸ’š</h1>
  <div class="card">
    <div class="grid cols-3">
      <div>
        <label>Credit Card Tips ($)</label>
        <input id="cc" type="number" step="0.01" min="0" placeholder="0.00">
      </div>
      <div>
        <label>Cash Tips ($)</label>
        <input id="cash" type="number" step="0.01" min="0" placeholder="0.00">
      </div>
      <div style="display:flex;align-items:end;gap:8px;">
        <button onclick="copyBreakdown()">Copy</button>
        <button onclick="resetAll()" style="background:#ccc;color:#000;">Reset</button>
      </div>
    </div>
  </div>

  <div class="grid cols-2">
    <div class="card">
      <h3 style="margin-top:0;">Percentages</h3>
      <label>Busboys %</label>
      <input id="busPct" type="number" step="0.1" value="15">
      <label>Busboy 1 % of bus pool</label>
      <input id="bus1Pct" type="number" step="0.1" value="65">
      <label>Runner %</label>
      <input id="runnerPct" type="number" step="0.1" value="7.5">
    </div>

    <div class="card">
      <h3 style="margin-top:0;">Names</h3>
      <label>Busboy 1</label>
      <input id="bus1Name" type="text" value="Busboy 1">
      <label>Busboy 2</label>
      <input id="bus2Name" type="text" value="Busboy 2">
      <label>Runner</label>
      <input id="runnerName" type="text" value="Food Runner">
      <label>Waiters (comma separated)</label>
      <input id="waiters" type="text" value="Waiter 1, Waiter 2">
    </div>
  </div>

  <div class="card">
    <h3 style="margin-top:0;">Results</h3>
    <div class="grid cols-3">
      <div class="metric"><div class="label">Total</div><div class="value" id="mTotal">$0.00</div></div>
      <div class="metric"><div class="label">Busboys</div><div class="value" id="mBus">$0.00</div></div>
      <div class="metric"><div class="label">Runner</div><div class="value" id="mRunner">$0.00</div></div>
    </div>
    <div class="grid cols-3">
      <div class="metric"><div class="label" id="mBus1Label">Busboy 1</div><div class="value" id="mBus1">$0.00</div></div>
      <div class="metric"><div class="label" id="mBus2Label">Busboy 2</div><div class="value" id="mBus2">$0.00</div></div>
      <div class="metric"><div class="label">Waiters pool</div><div class="value" id="mRemain">$0.00</div></div>
    </div>
    <div id="waiterPayouts"></div>
    <div class="small" id="checkLine"></div>
  </div>
</div>
<script>
function toCents(v){const n=parseFloat(v);return isNaN(n)?0:Math.round(n*100);}
function fmtUSD(c){return new Intl.NumberFormat('en-US',{style:'currency',currency:'USD'}).format(c/100);}
function round50(c){const d=c/100;const r=Math.round(d*2)/2;return Math.round(r*100);}
function distributeEvenly(total,n){
  if(n<=0)return {each:0,list:[]};
  const base=Math.floor(total/n);
  let rem=total-base*n;
  return {each:base,list:Array.from({length:n},(_,i)=>base+(i<rem?1:0))};
}

function recalc(){
  const cc=toCents(document.getElementById('cc').value);
  let cash=toCents(document.getElementById('cash').value);
  const total=cc+cash;

  const busPct=parseFloat(document.getElementById('busPct').value)||0;
  const bus1Pct=parseFloat(document.getElementById('bus1Pct').value)||0;
  const runnerPct=parseFloat(document.getElementById('runnerPct').value)||0;

  const bartender=Math.round(0.05*total);
  const busPool=Math.round(busPct/100*total);
  const bus1Target=Math.round(bus1Pct/100*busPool);
  const bus2Target=busPool-bus1Target;
  let runnerTarget=Math.round(runnerPct/100*total);

  // --- Cash-first logic ---
  let bus1Cash=0, bus2Cash=0, runnerCash=0;

  // pay Busboy 1 from cash
  if(cash>=bus1Target){ bus1Cash=bus1Target; cash-=bus1Target; }
  else { bus1Cash=cash; cash=0; }

  // if cash left, pay Busboy 2
  if(cash>0){
    if(cash>=bus2Target){ bus2Cash=bus2Target; cash-=bus2Target; }
    else { bus2Cash=cash; cash=0; }
  }

  // if still cash left, goes to runner
  if(cash>0){ runnerCash=cash; cash=0; }

  // compute book portions
  let bus1Book=bus1Target-bus1Cash;
  let bus2Book=bus2Target-bus2Cash;
  let runnerBook=runnerTarget-runnerCash;

  // round busser totals (cash+book)
  let bus1Total=round50(bus1Book+bus1Cash);
  let bus2Total=round50(bus2Book+bus2Cash);

  // recompute actual totals after rounding
  const totalBussers=bus1Total+bus2Total;
  const totalBart= bartender;
  const totalRunner=runnerBook+runnerCash;
  const remaining=total - (totalBussers + totalRunner + totalBart);

  const waiterNames=document.getElementById('waiters').value.split(',').map(x=>x.trim()).filter(Boolean);
  const split=distributeEvenly(remaining,waiterNames.length);

  // display metrics
  document.getElementById('mTotal').innerText=fmtUSD(total);
  document.getElementById('mBus').innerText=fmtUSD(busPool);
  document.getElementById('mRunner').innerText=fmtUSD(runnerTarget);
  document.getElementById('mBus1').innerText=fmtUSD(bus1Total);
  document.getElementById('mBus2').innerText=fmtUSD(bus2Total);
  document.getElementById('mRemain').innerText=fmtUSD(remaining);

  const payouts=document.getElementById('waiterPayouts');
  payouts.innerHTML='';

  const bartDiv=document.createElement('div');
  bartDiv.className='pill';
  bartDiv.innerHTML=`<div><b>Bartender</b><div class='small'>5% of total</div></div><div><b>${fmtUSD(bartender)}</b></div>`;
  payouts.appendChild(bartDiv);

  const b1=document.createElement('div');
  b1.className='pill';
  b1.innerHTML=`<div><b>Busboy 1</b><div class='small'>Cash: ${fmtUSD(bus1Cash)} + Book: ${fmtUSD(bus1Book)}</div></div><div><b>${fmtUSD(bus1Total)}</b></div>`;
  payouts.appendChild(b1);

  const b2=document.createElement('div');
  b2.className='pill';
  b2.innerHTML=`<div><b>Busboy 2</b><div class='small'>Cash: ${fmtUSD(bus2Cash)} + Book: ${fmtUSD(bus2Book)}</div></div><div><b>${fmtUSD(bus2Total)}</b></div>`;
  payouts.appendChild(b2);

  const run=document.createElement('div');
  run.className='pill';
  run.innerHTML=`<div><b>Runner</b><div class='small'>Cash: ${fmtUSD(runnerCash)} + Book: ${fmtUSD(runnerBook)}</div></div><div><b>${fmtUSD(totalRunner)}</b></div>`;
  payouts.appendChild(run);

  waiterNames.forEach((n,i)=>{
    const c=split.list[i]||0;
    const d=document.createElement('div');
    d.className='pill';
    d.innerHTML=`<div><b>${n}</b><div class='small'>Equal share</div></div><div><b>${fmtUSD(c)}</b></div>`;
    payouts.appendChild(d);
  });

  const sum=totalBussers+totalBart+totalRunner+split.list.reduce((a,b)=>a+b,0);
  document.getElementById('checkLine').innerText=`Check: ${fmtUSD(sum)} = ${fmtUSD(total)}`;
}

['cc','cash','busPct','bus1Pct','runnerPct','bus1Name','bus2Name','runnerName','waiters'].forEach(id=>{
  document.getElementById(id).addEventListener('input',recalc);
});
function copyBreakdown(){navigator.clipboard.writeText(document.body.innerText);alert('Copied breakdown.');}
function resetAll(){
  document.querySelectorAll('input').forEach(i=>i.value='');
  document.getElementById('busPct').value=15;
  document.getElementById('bus1Pct').value=65;
  document.getElementById('runnerPct').value=7.5;
  document.getElementById('waiters').value='Waiter 1, Waiter 2';
  recalc();
}
recalc();
if('serviceWorker' in navigator){navigator.serviceWorker.register('service-worker.js');}
</script>

</body>
</html>
